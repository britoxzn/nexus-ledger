<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nexus Finance Premium</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        :root {
            --primary: #4f46e5;
            --primary-dark: #4338ca;
            --success: #10b981;
            --danger: #ef4444;
            --bg-body: #f1f5f9;
            --bg-card: #ffffff;
            --text-main: #1e293b;
            --text-muted: #64748b;
            --border: #e2e8f0;
            --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
            --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
        }

        body { 
            font-family: 'Plus Jakarta Sans', sans-serif; 
            background-color: var(--bg-body); 
            margin: 0; 
            display: flex; 
            height: 100vh;
            color: var(--text-main);
            overflow: hidden;
        }

        /* ANIMAÇÃO DE ENTRADA */
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-in { animation: fadeIn 0.5s ease-out forwards; opacity: 0; }
        .delay-1 { animation-delay: 0.1s; }
        .delay-2 { animation-delay: 0.2s; }
        .delay-3 { animation-delay: 0.3s; }

        /* SIDEBAR */
        .sidebar { width: 280px; background: var(--bg-card); border-right: 1px solid var(--border); display: flex; flex-direction: column; padding: 32px 24px; flex-shrink: 0; z-index: 10; }
        .logo { font-size: 24px; font-weight: 800; color: var(--primary); display: flex; align-items: center; gap: 12px; margin-bottom: 48px; letter-spacing: -0.5px; }
        .nav-label { font-size: 11px; font-weight: 700; color: #94a3b8; text-transform: uppercase; margin-bottom: 12px; letter-spacing: 0.5px; }
        .nav-item { display: flex; align-items: center; gap: 12px; padding: 14px 16px; border-radius: 12px; color: var(--text-muted); text-decoration: none; font-weight: 600; font-size: 14px; transition: all 0.2s; cursor: pointer; margin-bottom: 8px; }
        .nav-item:hover { background-color: #f8fafc; color: var(--primary); }
        .nav-item.active { background-color: #eef2ff; color: var(--primary); }
        .nav-item i { font-size: 20px; }
        
        .logout-wrapper { margin-top: auto; border-top: 1px solid var(--border); padding-top: 24px; }
        .logout-btn { display: flex; align-items: center; gap: 10px; color: var(--text-muted); cursor: pointer; padding: 12px; font-weight: 600; background: transparent; border: none; width: 100%; transition: 0.2s; border-radius: 12px; }
        .logout-btn:hover { background: #fef2f2; color: var(--danger); }

        /* MAIN CONTENT */
        .main-content { flex: 1; overflow-y: auto; padding: 40px; }
        .page-header { margin-bottom: 40px; display: flex; justify-content: space-between; align-items: end; }
        .page-header h1 { margin: 0; font-size: 28px; font-weight: 800; color: #0f172a; letter-spacing: -1px; }
        .page-header p { margin: 8px 0 0; color: var(--text-muted); }
        .user-pill { background: white; padding: 8px 16px; border-radius: 30px; border: 1px solid var(--border); font-weight: 600; font-size: 13px; display: flex; align-items: center; gap: 8px; box-shadow: var(--shadow-sm); }

        /* HERO CARDS */
        .stats-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 24px; margin-bottom: 40px; }
        .stat-card { background: var(--bg-card); padding: 24px; border-radius: 20px; box-shadow: var(--shadow-md); border: 1px solid transparent; display: flex; flex-direction: column; justify-content: space-between; height: 140px; transition: transform 0.2s; }
        .stat-card:hover { transform: translateY(-2px); box-shadow: var(--shadow-lg); }
        .stat-header { display: flex; justify-content: space-between; align-items: start; margin-bottom: 16px; }
        .stat-icon { width: 40px; height: 40px; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 20px; }
        .stat-label { font-size: 13px; font-weight: 600; color: var(--text-muted); }
        .stat-value { font-size: 32px; font-weight: 800; letter-spacing: -1px; }

        .card-in .stat-icon { background: #dcfce7; color: #15803d; } .card-in .stat-value { color: #1e293b; }
        .card-out .stat-icon { background: #fee2e2; color: #b91c1c; } .card-out .stat-value { color: #1e293b; }
        
        /* O DESIGN ELITE (AZUL DEGRADÊ) */
        .card-hero { background: linear-gradient(135deg, var(--primary) 0%, #312e81 100%); color: white; border: none; }
        .card-hero .stat-label { color: #e0e7ff; }
        .card-hero .stat-value { color: white; }
        .card-hero .stat-icon { background: rgba(255,255,255,0.2); color: white; backdrop-filter: blur(10px); }

        /* GRID CENTRAL */
        .dashboard-grid { display: grid; grid-template-columns: 350px 1fr; gap: 32px; margin-bottom: 40px; }
        .panel { background: white; border-radius: 24px; padding: 24px; box-shadow: var(--shadow-md); border: 1px solid var(--border); }
        .panel-header { display: flex; align-items: center; gap: 10px; margin-bottom: 24px; font-size: 16px; font-weight: 700; color: #334155; }

        /* FORMULÁRIO */
        .form-group { margin-bottom: 16px; }
        .form-label { display: block; font-size: 12px; font-weight: 700; color: #475569; margin-bottom: 8px; text-transform: uppercase; }
        .form-input { width: 100%; padding: 14px; border: 1px solid #cbd5e1; border-radius: 12px; font-family: inherit; font-size: 14px; transition: 0.2s; background: #f8fafc; box-sizing: border-box; }
        .form-input:focus { outline: none; border-color: var(--primary); background: white; box-shadow: 0 0 0 4px rgba(79, 70, 229, 0.1); }
        .btn-primary { width: 100%; padding: 16px; background: var(--primary); color: white; border: none; border-radius: 12px; font-weight: 700; font-size: 15px; cursor: pointer; transition: 0.2s; margin-top: 8px; box-shadow: 0 4px 6px -1px rgba(79, 70, 229, 0.3); }
        .btn-primary:hover { background: var(--primary-dark); transform: translateY(-1px); }

        /* TABELA FLUTUANTE */
        table { width: 100%; border-collapse: separate; border-spacing: 0 12px; }
        th { text-align: left; padding: 0 24px 12px; color: var(--text-muted); font-size: 12px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px; }
        tbody tr { background: white; box-shadow: var(--shadow-sm); transition: transform 0.2s; }
        tbody tr:hover { transform: scale(1.01); box-shadow: var(--shadow-md); }
        td { padding: 20px 24px; border: none; font-size: 14px; color: #334155; border-top: 1px solid var(--border); border-bottom: 1px solid var(--border); }
        td:first-child { border-left: 1px solid var(--border); border-top-left-radius: 16px; border-bottom-left-radius: 16px; font-weight: 600; color: #0f172a; }
        td:last-child { border-right: 1px solid var(--border); border-top-right-radius: 16px; border-bottom-right-radius: 16px; }

        .category-tag { display: inline-flex; align-items: center; gap: 6px; padding: 6px 10px; background: #f1f5f9; border-radius: 8px; font-size: 12px; font-weight: 600; color: #475569; }
        .category-tag i { font-size: 14px; color: var(--primary); }

        .badge { padding: 6px 12px; border-radius: 20px; font-size: 11px; font-weight: 800; display: inline-flex; align-items: center; gap: 6px; letter-spacing: 0.5px; }
        .badge-in { background: #dcfce7; color: #166534; }
        .badge-out { background: #fee2e2; color: #991b1b; }
        .btn-delete-ghost { background: transparent; border: none; color: #94a3b8; cursor: pointer; padding: 8px; border-radius: 8px; transition: 0.2s; }
        .btn-delete-ghost:hover { background: #fee2e2; color: var(--danger); }

        /* MODAL */
        .modal-overlay { position: fixed; inset: 0; background: rgba(15, 23, 42, 0.6); backdrop-filter: blur(4px); display: none; align-items: center; justify-content: center; z-index: 50; }
        .modal-box { background: white; padding: 40px; border-radius: 24px; width: 400px; text-align: center; box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25); animation: popUp 0.3s cubic-bezier(0.16, 1, 0.3, 1); }
        @keyframes popUp { from { transform: scale(0.95); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        .modal-btns { display: flex; gap: 12px; margin-top: 32px; }
        .btn-modal { flex: 1; padding: 14px; border-radius: 12px; border: none; font-weight: 700; cursor: pointer; }
        .btn-confirm { background: var(--danger); color: white; }
        .btn-cancel { background: #f1f5f9; color: var(--text-muted); }
    </style>
</head>
<body>

    <aside class="sidebar">
        <div class="logo"><i class="ri-funds-box-fill"></i> Nexus Ledger</div>
        
        <div class="nav-label">Menu Principal</div>
        <div class="nav-item active"><i class="ri-home-5-line"></i> Visão Geral</div>
        <div class="nav-item"><i class="ri-exchange-dollar-line"></i> Transações</div>
        <div class="nav-item"><i class="ri-pie-chart-line"></i> Relatórios</div>
        
        <div class="nav-label" style="margin-top: 32px;">Configurações</div>
        <div class="nav-item"><i class="ri-user-settings-line"></i> Minha Conta</div>
        <div class="nav-item"><i class="ri-shield-key-line"></i> Segurança</div>

        <div class="logout-wrapper">
            <button class="logout-btn" onclick="sair()">
                <i class="ri-logout-box-r-line"></i> Sair da Conta
            </button>
        </div>
    </aside>

    <main class="main-content">
        
        <div class="page-header animate-in">
            <div>
                <h1>Dashboard</h1>
                <p>Bem-vindo de volta, Gerente.</p>
            </div>
            <div class="user-pill"><i class="ri-building-4-line"></i> Nexus Corp</div>
        </div>

        <div class="stats-grid animate-in delay-1">
            <div class="stat-card card-in">
                <div class="stat-header">
                    <span class="stat-icon"><i class="ri-arrow-up-line"></i></span>
                    <span class="stat-label">ENTRADAS</span>
                </div>
                <div class="stat-value" id="totalEntrada">R$ 0,00</div>
            </div>
            
            <div class="stat-card card-out">
                <div class="stat-header">
                    <span class="stat-icon"><i class="ri-arrow-down-line"></i></span>
                    <span class="stat-label">SAÍDAS</span>
                </div>
                <div class="stat-value" id="totalSaida">R$ 0,00</div>
            </div>
            
            <div class="stat-card card-hero">
                <div class="stat-header">
                    <span class="stat-icon"><i class="ri-wallet-3-line"></i></span>
                    <span class="stat-label">SALDO EM CONTA</span>
                </div>
                <div class="stat-value" id="saldo">R$ 0,00</div>
            </div>
        </div>

        <div class="dashboard-grid animate-in delay-2">
            <div style="display: flex; flex-direction: column; gap: 32px;">
                
                <div class="panel">
                    <div class="panel-header"><i class="ri-add-circle-fill" style="color: var(--primary);"></i> Novo Lançamento</div>
                    
                    <div class="form-group">
                        <label class="form-label">Descrição</label>
                        <input type="text" id="desc" class="form-input" placeholder="Ex: Assinatura Servidor">
                    </div>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                        <div class="form-group">
                            <label class="form-label">Valor (R$)</label>
                            <input type="number" id="valor" step="0.01" class="form-input" placeholder="0.00">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Data</label>
                            <input type="date" id="data" class="form-input">
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Categoria</label>
                        <select id="categoria" class="form-input">
                            <option value="Vendas"> Vendas / Receita</option>
                            <option value="Marketing"> Marketing / Ads</option>
                            <option value="Infraestrutura"> Infra / Servidores</option>
                            <option value="Pessoal"> Pessoal / Salários</option>
                            <option value="Alimentacao"> Alimentação</option>
                            <option value="Transporte"> Transporte</option>
                            <option value="Outros"> Outros</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Tipo</label>
                        <select id="tipo" class="form-input">
                            <option value="entrada">Entrada (Receita)</option>
                            <option value="saida">Saída (Despesa)</option>
                        </select>
                    </div>

                    <button class="btn-primary" onclick="adicionarTransacao()">Adicionar Lançamento</button>
                </div>

                <div class="panel" style="text-align: center;">
                    <div class="panel-header"><i class="ri-donut-chart-fill" style="color: var(--text-muted);"></i> Distribuição</div>
                    <div style="height: 200px; position: relative;">
                        <canvas id="meuGrafico"></canvas>
                        <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); pointer-events: none;">
                            <span style="font-size: 10px; font-weight: 700; color: #94a3b8; text-transform: uppercase;">Fluxo</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="panel animate-in delay-3" style="height: fit-content;">
                <div class="panel-header">
                    <i class="ri-file-list-3-fill" style="color: var(--text-muted);"></i> Últimas Movimentações
                    <span style="margin-left: auto; font-size: 12px; color: var(--primary); cursor: pointer;">Ver tudo</span>
                </div>
                
                <table>
                    <thead>
                        <tr>
                            <th>Descrição</th>
                            <th>Categoria</th>
                            <th>Status</th>
                            <th>Valor</th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody id="tabela-corpo">
                        </tbody>
                </table>
            </div>
        </div>
    </main>

    <div id="modal-delete" class="modal-overlay">
        <div class="modal-box">
            <div style="font-size: 48px; color: var(--danger); margin-bottom: 16px;"><i class="ri-delete-bin-2-line"></i></div>
            <h3 style="margin: 0 0 8px; font-size: 22px; color: #1e293b;">Remover item?</h3>
            <p style="margin: 0; color: #64748b; font-size: 15px;">Você tem certeza que deseja excluir este registro financeiro?</p>
            <div class="modal-btns">
                <button class="btn-modal btn-cancel" onclick="fecharModal()">Cancelar</button>
                <button class="btn-modal btn-confirm" onclick="confirmarDelecao()">Sim, Remover</button>
            </div>
        </div>
    </div>

    <script>
        const API_URL = 'https://nexus-ledger.onrender.com/login';
        let idParaDeletar = null;
        let chartInstance = null;

        window.onload = function() { carregarDados(); };

        async function carregarDados() {
            const token = localStorage.getItem('token');
            if (!token) { window.location.href = 'index.html'; return; }

            const respDash = await fetch(`${API_URL}/transactions/dashboard`, { headers: { 'Authorization': 'Bearer ' + token } });
            if (respDash.ok) {
                const data = await respDash.json();
                document.getElementById('totalEntrada').innerText = formatarMoeda(data.total_entrada);
                document.getElementById('totalSaida').innerText = formatarMoeda(data.total_saida);
                document.getElementById('saldo').innerText = formatarMoeda(data.saldo);
                atualizarGrafico(data.total_entrada, data.total_saida);
            }

            const respList = await fetch(`${API_URL}/transactions/`, { headers: { 'Authorization': 'Bearer ' + token } });
            if (respList.ok) {
                const transactions = await respList.json();
                preencherTabela(transactions);
            }
        }

        function atualizarGrafico(entrada, saida) {
            const ctx = document.getElementById('meuGrafico').getContext('2d');
            if (chartInstance) chartInstance.destroy();

            chartInstance = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Entrada', 'Saída'],
                    datasets: [{
                        data: [entrada, saida],
                        backgroundColor: ['#10b981', '#ef4444'],
                        borderWidth: 0, borderRadius: 20, hoverOffset: 10
                    }]
                },
                options: {
                    responsive: true, maintainAspectRatio: false, cutout: '85%',
                    plugins: { legend: { display: false } }
                }
            });
        }

        async function adicionarTransacao() {
            const token = localStorage.getItem('token');
            const desc = document.getElementById('desc').value;
            const valor = document.getElementById('valor').value;
            const tipo = document.getElementById('tipo').value;
            const cat = document.getElementById('categoria').value;
            const data = document.getElementById('data').value;

            if (!desc || !valor || !data) { alert("Preencha todos os campos!"); return; }

            try {
                await fetch(`${API_URL}/transactions/`, {
                    method: 'POST',
                    headers: { 'Authorization': 'Bearer ' + token, 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        title: desc, 
                        amount: parseFloat(valor), 
                        type: tipo, 
                        category: cat,
                        date: data 
                    })
                });
                carregarDados();
                document.getElementById('desc').value = "";
                document.getElementById('valor').value = "";
            } catch (error) { console.error(error); }
        }

        function preencherTabela(itens) {
            const tbody = document.getElementById('tabela-corpo');
            tbody.innerHTML = "";
            itens.slice().reverse().forEach(item => {
                const isEntrada = item.type === 'entrada';
                
                // LÓGICA DE ÍCONES DE CATEGORIA
                const icons = {
                    'Vendas': 'ri-money-dollar-circle-line',
                    'Marketing': 'ri-megaphone-line',
                    'Infraestrutura': 'ri-server-line',
                    'Pessoal': 'ri-user-smile-line',
                    'Alimentacao': 'ri-restaurant-line',
                    'Transporte': 'ri-car-line',
                    'Outros': 'ri-box-3-line'
                };
                const iconClass = icons[item.category] || 'ri-price-tag-3-line';

                const row = `
                    <tr>
                        <td style="display:flex; flex-direction:column;">
                            <span style="font-weight:700; color:#1e293b;">${item.title}</span>
                            <span style="font-size:11px; color:#94a3b8; font-weight:500;">ID: #${item.id}</span>
                        </td>
                        <td>
                            <div class="category-tag">
                                <i class="${iconClass}"></i>
                                ${item.category || 'Geral'}
                            </div>
                        </td>
                        <td><span class="badge ${isEntrada ? 'badge-in' : 'badge-out'}">${item.type.toUpperCase()}</span></td>
                        <td style="font-weight: 700; color: #1e293b;">${formatarMoeda(item.amount)}</td>
                        <td style="text-align: right;">
                            <button class="btn-delete-ghost" onclick="abrirModalDelete(${item.id})"><i class="ri-delete-bin-line"></i></button>
                        </td>
                    </tr>`;
                tbody.innerHTML += row;
            });
        }

        function abrirModalDelete(id) { idParaDeletar = id; document.getElementById('modal-delete').style.display = 'flex'; }
        function fecharModal() { document.getElementById('modal-delete').style.display = 'none'; idParaDeletar = null; }
        
        async function confirmarDelecao() {
            if (!idParaDeletar) return;
            const token = localStorage.getItem('token');
            await fetch(`${API_URL}/transactions/${idParaDeletar}`, { method: 'DELETE', headers: { 'Authorization': 'Bearer ' + token } });
            fecharModal(); carregarDados();
        }

        function formatarMoeda(valor) { return valor.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' }); }
        function sair() { localStorage.removeItem('token'); window.location.href = 'index.html'; }
    </script>
</body>
</html>

